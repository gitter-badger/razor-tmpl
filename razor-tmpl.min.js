String.prototype.razorReplaceAll=function(n,t){return this.replace(new RegExp(n,"g"),t)};String.prototype.razorFormat=function(){var n=this;for(var t in arguments)n=n.razorReplaceAll("\\{"+t+"\\}",arguments[t].toString());return n},function(n){function i(n,t){this.Content=n;this.SegmentType=t;this.toString=function(){return this.Content}}function h(n){this.template=n;this.processedIndex=-1;this.segments=[]}var t,s,e;t={CodeBlock:0,Variable:1,String:2};var o={Each:/^each\s*?\([\s\S]+?\)\s*?\{[\s\S]*?\}/,Noraml:/[\S\s]*?\{[\S\s]*?\}/},r={symbol:"@",process:function(n){var t=new h(n);return this.processStringBlock(t),t.segments},processStringBlock:function(n){for(var e,i,r,f,u=n.template,t=0,s=u.length;t<s;t++)if(e=u[t],i="",e==this.symbol)if(this.processString(n,t),i=u[t+1],i==this.symbol){t=this.processEscapeSymbol(n,t);continue}else if(i=="*"){t=this.processComment(n,t);continue}else{for(r=t+1;i==" "||i=="\n";)i=u[++r];switch(i){case"{":t=this.processCodeBlock(n,t,r);break;case"(":t=this.processVariable(n,t,r);break;default:f=n.template.substring(r);o.Each.test(f)?t=this.processEach(n,t,r):o.Noraml.test(f)&&(t=this.processNormal(n,t,r))}}this.processString(n,n.template.length)},processString:function(n,r){var u=n.template.substring(n.processedIndex+1,r);u.trim()&&n.segments.push(new i(u,t.String));n.processedIndex=r-1},processComment:function(n,t){var u=n.template.substring(t),r=u.indexOf("*"+this.symbol),i;if(r>-1)return i=r+t+1,n.processedIndex=i,i;throw Error("注释错误");},processEscapeSymbol:function(n,r){return n.segments.push(new i(this.symbol,t.String)),n.processedIndex=r+1,n.processedIndex},processCodeBlock:function(n,r,u){var e=this.getSecondIndex(n.template,u),f=n.template.substring(u+1,e);return f&&(f=this.decodeHtmlEntity(f),n.segments.push(new i(f,t.CodeBlock))),n.processedIndex=e},processVariable:function(n,r,f){var o=this.getSecondIndex(n.template,f),e=n.template.substring(r+2,o).trim();return e&&(e=this.decodeHtmlEntity(e),/^-/g.test(e)?(e=e.substring(1).trim(),e+=".replace(/&/g,'&amp;')",e+=".replace(/<\/g,'&lt;')",e+=".replace(/>/g,'&gt;')",e+=".replace(/'/g,'&#39;')",e+='.replace(/"/g,"&#34;")',e+=".replace(/\\//g,'&#47;')",n.segments.push(new i(e,t.Variable))):/^=/g.test(e)?(e=e.substring(1).trim(),e=u.modelName+"."+e,n.segments.push(new i(e,t.Variable))):n.segments.push(new i(e,t.Variable))),n.processedIndex=o},processEach:function(n,r){var f=n.template.substring(r),e=f.indexOf("(")+r,a=this.getSecondIndex(n.template,e),o=f.indexOf("{")+r,s=this.getSecondIndex(n.template,o),u=n.template.substring(e+1,a),h=u.indexOf("in"),v=u.substring(0,h).trim(),y=u.substring(h+2).trim(),p="for(var $index = 0,$length = {1}.length;$index < $length;$index++) { var {0} = {1}[$index];".razorFormat(v,y),c,l;return n.segments.push(new i(p,t.CodeBlock)),c=n.template.substring(o+1,s),l=this.process(c),n.segments=n.segments.concat(l),n.segments.push(new i("}",t.CodeBlock)),n.processedIndex=s},processNormal:function(n,r,u){var h=n.template.substring(r),f=h.indexOf("{")+r,o=this.getSecondIndex(n.template,f),e=n.template.substring(u,f+1),c=n.template.substring(f+1,o),s;return e=this.decodeHtmlEntity(e),n.segments.push(new i(e,t.CodeBlock)),s=this.process(c),n.segments=n.segments.concat(s),n.segments.push(new i("}",t.CodeBlock)),n.processedIndex=o},getSecondIndex:function(n,t){for(var u,f=n.substr(t,1),e={"{":"}","(":")"}[f],r=1,i=t+1,o=n.length;i<o;i++)if(u=n.substr(i,1),u==e){if(r--,r==0)break}else u==f&&r++;return i},decodeHtmlEntity:function(n){return n.razorReplaceAll("&lt;","<").razorReplaceAll("&gt;",">").razorReplaceAll("&amp;","&")}},u={modelName:"ViewBag",mode:"normal",escapeInFunction:function(n){return n?n.replace(/'/g,"\\'").replace(/"/g,'\\"').replace(/(\r?\n)+/g,"\\n"):n},filter:function(n){for(var r,u,f=[],i=0,e=n.length;i<e;i++)if(r=n[i-1],u=n[i],r&&r.SegmentType===t.CodeBlock&&!u.Content.trim())continue;else f.push(u);return f},compile:function(n){var i=[],f,r,u;i.push("var $result='';");try{for(f in n){r=n[f].Content;switch(n[f].SegmentType){case t.CodeBlock:i.push(r);break;case t.Variable:u="$result+={0};".razorFormat(r);i.push(u);break;case t.String:u="$result+='{0}';".razorFormat(this.escapeInFunction(r));i.push(u)}}return i.push("return $result;"),new Function(this.modelName,i.join("\n"))}catch(e){return console.log("new Function出错,请检查 模板语法 ..."),console.log(e),console.log(i.join("\n")),new Function("return '';")}}},f={compile:function(n){var t=r.process(n);return u.compile(t)},render:function(n,t){var i,r,u;if(!this.withViewBag){i="";for(r in t)i+="var {0} = ViewBag['{0}'];".razorFormat(r);n="@{"+i+"}"+n}return u=this.compile(n),u(t)},withViewBag:!0,symbol:function(n){return n?(r.symbol=n,this):r.symbol},model:function(n){return n?(u.modelName=n,this):u.modelName},init:function(){return this.withViewBag=!0,this.symbol("@").model("ViewBag")},version:"0.9.0",update_date:"2014-7-20",encodeHtml:function(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#39;").replace(/"/g,"&#34;").replace(/\//g,"&#47;")},decodeHtml:function(n){return r.decodeHtmlEntity(n)}};typeof module!="undefined"&&module.exports?module.exports=f:n.razor=f;typeof $!="undefined"&&$&&($(function(){$("[razor-template]").hide()}),s=function(n){var t=n.attr("razor-for")||n.attr("data-razor-for");return t?"for({0}){".razorFormat(t.trim()):(t=n.attr("razor-if")||n.attr("data-razor-if"),t)?"if({0}){".razorFormat(t.trim()):(t=n.attr("razor-while")||n.attr("data-razor-while"),t)?"while({0}){".razorFormat(t.trim()):(t=n.attr("razor-each")||n.attr("data-razor-each"),t)?"each({0}){".razorFormat(t):""},e=function(n){var t=n[0].tagName==="SCRIPT"?n.html():n.attr("razor-template")||n.html(),i=s(n);return i&&(t=r.symbol+i+t+"}"),t},$.fn.extend({compile:function(){return f.compile(e(this))},render:function(n){var r=e(this),t=f.render(r,n),i;return this[0].tagName!=="SCRIPT"&&(this.attr("razor-template")||(i=this.html().trim(),this.attr("razor-template",i)),this.html(t),this.show()),t},renderToParent:function(n){var t=this.render(n);this.parent().append(t)}}))}(this);
/*
//# sourceMappingURL=razor-tmpl.min.js.map
*/