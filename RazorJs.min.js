//------------------------------------
// Created BY Magicdawn
// 2014-4-18 16:56:12
//http://tool.oschina.net/jscompress
//------------------------------------

String.prototype.replaceAll = function (b, a) { return this.replace(new RegExp(b, "g"), a) }; String.prototype.format = function (e, d, c) { var a = this; for (var b in arguments) { a = a.replaceAll("\\{" + b + "\\}", arguments[b].toString()) } return a }; (function (a) { var c = { CodeBlock: 0, Variable: 1, String: 2 }; function b(j, k) { this.Content = j; this.SegmentType = k } function i(j) { this.template = j; this.processedIndex = -1; this.segments = [] } var g = { Loop: /^\S(for|while)\s*?\([\s\S]*?\)\s*?\{[\s\S]*?\}/g, LoopString: "^\\S(for|while)\\s*?\\([\\s\\S]*?\\)\\s*?\\{[\\s\\S]*?\\}", LoopFlag: "g", IfElse: /^\Sif\([\s\S]*?\)[\s\S]*?(else)?/g, IfElseString: "^\\Sif\\([\\s\\S]*?\\)[\\s\\S]*?(else)?", IfElseFlag: "g" }; function f(j) { return j.replace(/\/\/.*$/gm, "").replace(/\/\*[\s\S]*\*\//g, "").replace(/\n+/g, "").replace(/ +/g, " ") } var h = { symbol: "@", process: function (k) { var j = new i(f(k)); this.processStringBlock(j); return j.segments }, processStringBlock: function (k) { var m = k.template; for (var j = 0, o = m.length; j < o; j++) { var p = m[j]; if (p == this.symbol) { this.processString(k, j); var l = m[j + 1]; switch (l) { case this.symbol: j = this.processEscapeSymbol(k, j); break; case "{": j = this.processCodeBlock(k, j); break; case "(": j = this.processVariable(k, j); break; default: var q = k.template.substring(j); if (new RegExp(g.LoopString, g.LoopFlag).test(q)) { j = this.processLoop(k, j) } else { if ((new RegExp(g.IfElseString, g.IfElseFlag)).test(q)) { j = this.processCondition(k, j) } } break } } } var n = k.template.substring(k.processedIndex + 1, k.template.length).trim(); if (n) { k.segments.push(new b(n, c.String)) } }, processString: function (k, j) { var l = k.template.substring(k.processedIndex + 1, j).trim(); if (l) { k.segments.push(new b(l, c.String)) } k.processedIndex = j - 1 }, processEscapeSymbol: function (k, j) { k.segments.push(new b(this.symbol, c.String)); k.processedIndex = j + 1; return k.processedIndex }, processCodeBlock: function (k, j) { var l = this.getSecondBraceIndex(k.template, j + 1); var m = k.template.substring(j + 2, l).trim(); if (m) { m = this.getOriginalFromEscapedCode(m); k.segments.push(new b(m, c.CodeBlock)) } k.processedIndex = l; return k.processedIndex }, processVariable: function (k, j) { var l = this.getSecondBraceIndex(k.template, j + 1); var m = k.template.substring(j + 2, l).trim(); if (m) { m = this.getOriginalFromEscapedCode(m); if (/^- /g.test(m)) { m = m.substring(2); m = "({0}).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')".format(m); k.segments.push(new b(m, c.Variable)) } else { k.segments.push(new b(m, c.Variable)) } } k.processedIndex = l; return k.processedIndex }, processLoop: function (o, q) { var p = o.template.substring(q); var k = p.indexOf("{") + q; var j = this.getSecondBraceIndex(o.template, k); var n = o.template.substring(q + 1, k + 1); var m = o.template.substring(k + 1, j); var l = "}"; n = this.getOriginalFromEscapedCode(n); o.segments.push(new b(n, c.CodeBlock)); var r = this.process(m); o.segments = o.segments.concat(r); o.segments.push(new b(l, c.CodeBlock)); o.processedIndex = j; return o.processedIndex }, processCondition: function (q, s) { var r = q.template.substring(s); var j = r.indexOf("{") + s; var l = this.getSecondBraceIndex(q.template, j); var p = q.template.substring(s + 1, j + 1); var o = q.template.substring(j + 1, l); var n = "}"; p = this.getOriginalFromEscapedCode(p); q.segments.push(new b(p, c.CodeBlock)); var x = this.process(o); q.segments = q.segments.concat(x); q.segments.push(new b(n, c.CodeBlock)); q.processedIndex = l; r = q.template.substring(l + 1); if (/^\s*else/g.test(r)) { var k = r.indexOf("{") + l + 1; var u = this.getSecondBraceIndex(q.template, k); var w = "else{"; var v = q.template.substring(k + 1, u); var t = "}"; q.segments.push(new b(w, c.CodeBlock)); var m = this.process(v); q.segments = q.segments.concat(m); q.segments.push(new b(t, c.CodeBlock)); q.processedIndex = u } return q.processedIndex }, getSecondBraceIndex: function (m, k) { var q = m.substr(k, 1); var j = q == "{" ? "}" : ")"; var o = 1; var l = k + 1; var n = m.length; for (; l < n; l++) { var p = m.substr(l, 1); if (p == q) { o++ } else { if (p == j) { o--; if (o == 0) { break } } } } return l }, getOriginalFromEscapedCode: function (j) { return j.replaceAll("&lt;", "<").replaceAll("&gt;", ">").replaceAll("&amp;", "&") } }; var d = { modelName: "ViewBag", enableEmptyValue: false, compile: function (k) { var m = []; m.push("var result='';"); for (var l in k) { var n = k[l].Content; switch (k[l].SegmentType) { case c.CodeBlock: m.push(n); break; case c.Variable: if (!this.enableEmptyValue) { var j = "result+={0};".format(n); m.push(j) } else { var j = "if(typeof({0}) != 'undefined' && {0}) result+={0}; else result+='{0}';".format(n); m.push(j) } break; case c.String: var j = "result+='{0}';".format(n.replaceAll("'", "\\'").replaceAll('"', '\\"')); m.push(j); break; default: break } } m.push("return result;"); return new Function(this.modelName, m.join("")) } }; var e = { compile: function (k) { var j = h.process(k); var l = d.compile(j); return l }, render: function (k, j) { var l = this.compile(k); return l(j) }, changeSymbol: function (j) { h.symbol = j }, changeModelName: function (j) { d.modelName = j }, enableEmptyValue: function (j) { d.enableEmptyValue = j }, init: function () { this.changeSymbol("@"); this.changeModelName("ViewBag"); this.enableEmptyValue(false) } }; if (typeof (module) != "undefined" && module.exports) { module.exports = e } else { a.razor = e } if (typeof ($) != "undefined" && $) { $(function () { $("[razor-template]").hide() }); $.fn.extend({ compile: function () { return e.compile(this.html()) }, render: function (k) { var j = this.html(); return e.render(j, k) }, renderToParent: function (k) { var j = this.render(k); this.parent().append(j) }, renderInParent: function (l, k) { var j = this.render(l); if (k) { var m = this; this.parent().html(""); this.parent().append(this); this.parent().append(j) } else { this.parent().html(j) } }, compileNode: function () { var k = []; var j = (function (r) { var q = { content: null, symbol: null }; var p = r.attr("razor-for") || r.attr("data-razor-for"); if (p) { q.content = p; q.symbol = "for"; return q } p = r.attr("razor-if") || r.attr("data-razor-if"); if (p) { q.content = p; q.symbol = "if"; return q } p = r.attr("razor-while") || r.attr("data-razor-while"); if (p) { q.content = p; q.symbol = "while"; return q } return q })(this); if (j.symbol) { var n = j.symbol + "(" + j.content + "){"; k.push(new b(n, c.CodeBlock)) } var o = this.attr("razor-template") || this.html(); var l = h.process(o); k = k.concat(l); if (j.symbol) { k.push(new b("}", c.CodeBlock)) } var m = d.compile(k); return m }, renderNode: function (k) { var l = this.compileNode(); var j = l(k); if (!this.attr("razor-template")) { var m = this.html().trim(); this.attr("razor-template", m) } this.html(j); this.show() }, compileRepeat: function () { var m = []; var p = this.attr("razor-repeat").trim() || this.attr("data-razor-repeat").trim(); if (p) { var q = p.indexOf("in"); var r = p.substring(0, q).trim(); var o = p.substring(q + 2).trim(); var n = "for(var index in {0}){ var {1} = {0}[index];".format(o, r); m.push(new b(n, c.CodeBlock)) } var l = this.attr("razor-template") || this.html(); var j = h.process(l); m = m.concat(j); if (p) { m.push(new b("}", c.CodeBlock)) } var k = d.compile(m); return k }, renderRepeat: function (k) { var l = this.compileRepeat(); var j = l(k); if (!this.attr("razor-template")) { var m = this.html().trim(); this.attr("razor-template", m) } this.html(j); this.show() } }) } })(this);